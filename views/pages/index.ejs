<!DOCTYPE html>
<html>
<head>
  <% include ../partials/header.ejs %>
  
</head>

<body>

<div class="jumbotron text-center">
  <div class="container">
    <h1>BC Research Sign In Board</h1>
	
	<button class="accordion">Add Person</button>
	<div class="panel">
	
<form id="addUser">
<ul class="form-style-1">
        <li>
        <label>Name <span class="required">*</span></label>
        <input type="text" name="name" id="name" class="keyboard-normal" placeholder="First Last"/>
		</li>
        <li>
        <label>Email <span class="required">*</span></label>
        <input type="email" name="contact_email" id="contact_email" class="keyboard-normal" />
		</li>
		<li>
        <label>Cell phone</label>
        <input type="text" name="contact_phone" id="contact_phone" class="keyboard-num" />
		</li>
        <li>
        <label>Emergency Contact <span class="required">*</span></label>
        <input type="text" name="emergency_name" id="emergency_name" class="keyboard-normal" />
		</li>
		<li>
        <label>Emergency Contact Phone <span class="required">*</span></label>
        <input type="text" name="emergency_phone" id="emergency_phone" class="keyboard-num" />
		</li>
		 <li>
        <input type="submit" value="Add Person">
		</li>
</ul>
</form>
	
		</div>
	</div>
	</div>
	
  </div>
</div>


  <div class="container">
  <div class="alert alert-info text-center" role="alert">
    

    	

<article>
  	<div id="display"> </div>
  </article>
	
	
  </div>
  
 	<p2 id="socketio" > Database not connected </p> 
</div>
	

	    <script src="/socket.io/socket.io.js"></script>
    <script>
	
	//connect to server, access list of users from database, display users with checkboxes
      var socket = io();
      socket.on('connect', function() {
        document.getElementById("socketio").innerHTML = "Database connected";
      });
      socket.on('showrows', function(rows) {
        var html='';
        for (var i=0; i<rows.length; i++) {
          html += '<div class="item"><p>' + rows[i].name + '</p><input type="checkbox" id="'+rows[i].employeeid +'" name="' + rows[i].name +'" value="" '+ rows[i].checkbox +' onClick="buttonClicked({id:this.id,name:this.name,status:document.getElementById(this.id).checked})"><div class="toggle"><label for="' + rows[i].employeeid +'" data-off="out" data-on="in"><i></i></label></div></div>';		  
        }
		
        document.getElementById("display").innerHTML = html;
		//alert("rows updated"); 
		});
	
	socket.on('reload', function(data) {
		location.reload();
	});
	
		
	//emit socket clicked to change in/out status in GS:
		function buttonClicked(person){
		 	socket.emit('clicked', person);
			}
			 
	//listen for "clicked2" events to change in/out status
		socket.on('clicked2', function(person) {
 
			$('input#'+person.id).prop('checked', person.status);
		});
		
	//emit socket newUser to add user when addUser form submit is pressed
		$(document).on('submit','form#addUser',function(e){
			e.preventDefault();
			//jQuery grabs form data, convert it into an object
			var formdata = $(this).serializeArray();
			var person ={};
			$(formdata).each(function(index, obj){
				person[obj.name] = obj.value;
			});
			
			socket.emit('add', person);
			
			
			//clear form
			$( 'form#addUser' ).each(function(){
    			this.reset();
			});
			//close accordion
			var acc = document.getElementsByClassName("accordion");
			acc[0].click()	;

		});

    </script>

		<script>
		//JS script for accordions
	var acc = document.getElementsByClassName("accordion");
	var i;
	for (i = 0; i < acc.length; i++) {
	  acc[i].onclick = function() {
		this.classList.toggle("active");
		var panel = this.nextElementSibling;
		if (panel.style.maxHeight){
		  panel.style.maxHeight = null;
		} else {
		  panel.style.maxHeight = panel.scrollHeight + "px";
		} 
	  }
	}
	
	</script>
</body>
</html>
